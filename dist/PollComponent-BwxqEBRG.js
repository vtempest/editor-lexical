import{jsx as e,jsxs as o}from"react/jsx-runtime";import{useCollaborationContext as t}from"@lexical/react/LexicalCollaborationContext";import{useLexicalComposerContext as l}from"@lexical/react/LexicalComposerContext";import{useLexicalNodeSelection as n}from"@lexical/react/useLexicalNodeSelection";import{mergeRegister as i}from"@lexical/utils";import{$getSelection as a,CLICK_COMMAND as r,COMMAND_PRIORITY_LOW as s,$isNodeSelection as c,$getNodeByKey as d}from"lexical";import{useMemo as p,useState as m,useRef as u,useEffect as N}from"react";import{a5 as h,a6 as _,a7 as x,a8 as f}from"./editor-Dv-3TiYC.js";function P({option:l,index:n,options:i,totalVotes:a,withPollNode:r}){const{name:s}=t(),c=u(null),d=l.votes,p=-1!==d.indexOf(s),m=d.length,N=l.text;/* @__PURE__ */
return o("div",{className:"PollNode__optionContainer",children:[/* @__PURE__ */e("div",{className:f("PollNode__optionCheckboxWrapper",p&&"PollNode__optionCheckboxChecked"),children:/* @__PURE__ */e("input",{ref:c,className:"PollNode__optionCheckbox",type:"checkbox",onChange:e=>{r(e=>{e.toggleVote(l,s)})},checked:p})}),/* @__PURE__ */o("div",{className:"PollNode__optionInputWrapper",children:[/* @__PURE__ */e("div",{className:"PollNode__optionInputVotes",style:{width:(0===m?0:m/a*100)+"%"}}),/* @__PURE__ */e("span",{className:"PollNode__optionInputVotesCount",children:m>0&&(1===m?"1 vote":`${m} votes`)}),/* @__PURE__ */e("input",{className:"PollNode__optionInput",type:"text",value:N,onChange:e=>{const o=e.target,t=o.value,n=o.selectionStart,i=o.selectionEnd;r(e=>{e.setOptionText(l,t)},()=>{o.selectionStart=n,o.selectionEnd=i})},placeholder:`Option ${n+1}`})]}),/* @__PURE__ */e("button",{disabled:i.length<3,className:f("PollNode__optionDelete",i.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{r(e=>{e.deleteOption(l)})}})]})}function C({question:t,options:f,nodeKey:C}){const[v]=l(),g=p(()=>function(e){return e.reduce((e,o)=>e+o.votes.length,0)}(f),[f]),[b,k,O]=n(C),[y,V]=m(null),I=u(null);N(()=>i(v.registerUpdateListener(({editorState:e})=>{V(e.read(()=>a()))}),v.registerCommand(r,e=>{const o=e;return o.target===I.current&&(o.shiftKey||O(),k(!b),!0)},s)),[O,v,b,C,k]);const L=(e,o)=>{v.update(()=>{const o=d(C);_(o)&&e(o)},{onUpdate:o})},S=c(y)&&b;/* @__PURE__ */
return e("div",{className:"PollNode__container "+(S?"focused":""),ref:I,children:/* @__PURE__ */o("div",{className:"PollNode__inner",children:[/* @__PURE__ */e("h2",{className:"PollNode__heading",children:t}),f.map((o,t)=>{const l=o.uid;/* @__PURE__ */
return e(P,{withPollNode:L,option:o,index:t,options:f,totalVotes:g},l)}),/* @__PURE__ */e("div",{className:"PollNode__footer",children:/* @__PURE__ */e(h,{onClick:()=>{L(e=>{e.addOption(x())})},small:!0,children:"Add Option"})})]})})}export{C as default};
