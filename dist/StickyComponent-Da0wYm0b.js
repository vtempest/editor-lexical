import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useCollaborationContext as o}from"@lexical/react/LexicalCollaborationContext";import{CollaborationPlugin as r}from"@lexical/react/LexicalCollaborationPlugin";import{useLexicalComposerContext as n}from"@lexical/react/LexicalComposerContext";import{LexicalErrorBoundary as l}from"@lexical/react/LexicalErrorBoundary";import{HistoryPlugin as i}from"@lexical/react/LexicalHistoryPlugin";import{LexicalNestedComposer as a}from"@lexical/react/LexicalNestedComposer";import{PlainTextPlugin as c}from"@lexical/react/LexicalPlainTextPlugin";import{calculateZoomLevel as s}from"@lexical/utils";import{$getNodeByKey as u}from"lexical";import{useRef as m,useEffect as d,useLayoutEffect as p}from"react";import{ae as g,O as f,af as x,Z as y,a0 as v,ag as h}from"./editor-Dv-3TiYC.js";const E={...g,paragraph:"StickyEditorTheme__paragraph"};function C(e,t){const o=e.style,r=t.rootElementRect,n=null!==r?r.left:0,l=null!==r?r.top:0;o.top=l+t.y+"px",o.left=n+t.x+"px"}function L({x:g,y:L,nodeKey:b,color:R,caption:k}){const[N]=n(),D=m(null),P=m({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0}),{isCollabActive:w}=o();d(()=>{const e=P.current;e.x=g,e.y=L;const t=D.current;null!==t&&C(t,e)},[g,L]),p(()=>{const e=P.current,t=new ResizeObserver(t=>{for(let o=0;o<t.length;o++){const r=t[o],{target:n}=r;e.rootElementRect=n.getBoundingClientRect();const l=D.current;null!==l&&C(l,e)}}),o=N.registerRootListener((e,o)=>{null!==o&&t.unobserve(o),null!==e&&t.observe(e)}),r=()=>{const t=N.getRootElement(),o=D.current;null!==t&&null!==o&&(e.rootElementRect=t.getBoundingClientRect(),C(o,e))};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),o()}},[N]),d(()=>{const e=D.current;null!==e&&setTimeout(()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")},500)},[]);const B=e=>{const t=D.current,o=P.current,r=o.rootElementRect,n=s(t);null!==t&&o.isDragging&&null!==r&&(o.x=e.pageX/n-o.offsetX-r.left,o.y=e.pageY/n-o.offsetY-r.top,C(t,o))},X=e=>{const t=D.current,o=P.current;null!==t&&(o.isDragging=!1,t.classList.remove("dragging"),N.update(()=>{const e=u(b);h(e)&&e.setPosition(o.x,o.y)})),document.removeEventListener("pointermove",B),document.removeEventListener("pointerup",X)},{historyState:_}=f();/* @__PURE__ */
return e("div",{ref:D,className:"sticky-note-container",children:/* @__PURE__ */t("div",{className:`sticky-note ${R}`,onPointerDown:e=>{const t=D.current;if(null==t||2===e.button||e.target!==t.firstChild)return;const o=t,r=P.current;if(null!==o){const{top:t,left:n}=o.getBoundingClientRect(),l=s(o);r.offsetX=e.clientX/l-n,r.offsetY=e.clientY/l-t,r.isDragging=!0,o.classList.add("dragging"),document.addEventListener("pointermove",B),document.addEventListener("pointerup",X),e.preventDefault()}},children:[/* @__PURE__ */e("button",{onClick:()=>{N.update(()=>{const e=u(b);h(e)&&e.remove()})},className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),/* @__PURE__ */e("button",{onClick:()=>{N.update(()=>{const e=u(b);h(e)&&e.toggleColor()})},className:"color","aria-label":"Change sticky note color",title:"Color",children:/* @__PURE__ */e(x,{name:"paint-bucket"})}),/* @__PURE__ */t(a,{initialEditor:k,initialTheme:E,children:[w?/* @__PURE__ */e(r,{id:k.getKey(),providerFactory:y,shouldBootstrap:!0}):/* @__PURE__ */e(i,{externalHistoryState:_}),/* @__PURE__ */e(c,{contentEditable:/* @__PURE__ */e(v,{placeholder:"What's up?",placeholderClassName:"StickyNode__placeholder",className:"StickyNode__contentEditable"}),ErrorBoundary:l})]})]})})}export{L as default};
