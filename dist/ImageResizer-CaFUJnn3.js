import{jsxs as e,jsx as t}from"react/jsx-runtime";import{calculateZoomLevel as r}from"@lexical/utils";import{useRef as i}from"react";function n(e,t,r){return Math.min(Math.max(e,t),r)}const s=1,o=8,a=2,c=4;function l({onResizeStart:l,onResizeEnd:u,buttonRef:d,imageRef:m,maxWidth:g,editor:h,showCaption:p,setShowCaption:y,captionsEnabled:w}){const z=i(null),v=i({priority:"",value:"default"}),f=i({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),b=h.getRootElement(),P=g||(null!==b?b.getBoundingClientRect().width-20:100),R=null!==b?b.getBoundingClientRect().height-20:100,x=(e,t)=>{if(!h.isEditable())return;const i=m.current,n=z.current;if(null!==i&&null!==n){e.preventDefault();const{width:u,height:d}=i.getBoundingClientRect(),m=r(i),g=f.current;g.startWidth=u,g.startHeight=d,g.ratio=u/d,g.currentWidth=u,g.currentHeight=d,g.startX=e.clientX/m,g.startY=e.clientY/m,g.isResizing=!0,g.direction=t,(e=>{const t=e===s||e===c?"ew":e===o||e===a?"ns":e&o&&e&c||e&a&&e&s?"nwse":"nesw";null!==b&&b.style.setProperty("cursor",`${t}-resize`,"important"),null!==document.body&&(document.body.style.setProperty("cursor",`${t}-resize`,"important"),v.current.value=document.body.style.getPropertyValue("-webkit-user-select"),v.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))})(t),l(),n.classList.add("image-control-wrapper--resizing"),i.style.height=`${d}px`,i.style.width=`${u}px`,document.addEventListener("pointermove",W),document.addEventListener("pointerup",H)}},W=e=>{const t=m.current,i=f.current,l=i.direction&(s|c),u=i.direction&(a|o);if(null!==t&&i.isResizing){const o=r(t);if(l&&u){let r=Math.floor(i.startX-e.clientX/o);r=i.direction&s?-r:r;const a=n(i.startWidth+r,100,P),c=a/i.ratio;t.style.width=`${a}px`,t.style.height=`${c}px`,i.currentHeight=c,i.currentWidth=a}else if(u){let r=Math.floor(i.startY-e.clientY/o);r=i.direction&a?-r:r;const s=n(i.startHeight+r,100,R);t.style.height=`${s}px`,i.currentHeight=s}else{let r=Math.floor(i.startX-e.clientX/o);r=i.direction&s?-r:r;const a=n(i.startWidth+r,100,P);t.style.width=`${a}px`,i.currentWidth=a}}},H=()=>{const e=m.current,t=f.current,r=z.current;if(null!==e&&null!==r&&t.isResizing){const e=t.currentWidth,i=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,r.classList.remove("image-control-wrapper--resizing"),null!==b&&b.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",v.current.value,v.current.priority)),u(e,i),document.removeEventListener("pointermove",W),document.removeEventListener("pointerup",H)}};/* @__PURE__ */
return e("div",{ref:z,children:[!p&&w&&/* @__PURE__ */t("button",{className:"image-caption-button",ref:d,onClick:()=>{y(!p)},children:"Add Caption"}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{x(e,o)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{x(e,o|s)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{x(e,s)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{x(e,a|s)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{x(e,a)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{x(e,a|c)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{x(e,c)}}),/* @__PURE__ */t("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{x(e,o|c)}})]})}export{l as I};
