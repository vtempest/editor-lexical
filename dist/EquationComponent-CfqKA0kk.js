import{jsxs as e,jsx as t,Fragment as n}from"react/jsx-runtime";import{useLexicalComposerContext as a}from"@lexical/react/LexicalComposerContext";import{useLexicalEditable as r}from"@lexical/react/useLexicalEditable";import{mergeRegister as i}from"@lexical/utils";import{isHTMLElement as o,$getNodeByKey as l,SELECTION_CHANGE_COMMAND as c,COMMAND_PRIORITY_HIGH as s,KEY_ESCAPE_COMMAND as u,$getSelection as d,$isNodeSelection as m}from"lexical";import{forwardRef as E,useState as p,useRef as f,useCallback as q,useEffect as g}from"react";import{aa as h,ab as x,ac as N}from"./editor-Dv-3TiYC.js";function _({equation:n,setEquation:a,inline:r},i){const l=e=>{a(e.target.value)};return r&&o(i)?/* @__PURE__ */e("span",{className:"EquationEditor_inputBackground",children:[/* @__PURE__ */t("span",{className:"EquationEditor_dollarSign",children:"$"}),/* @__PURE__ */t("input",{className:"EquationEditor_inlineEditor",value:n,onChange:l,autoFocus:!0,ref:i}),/* @__PURE__ */t("span",{className:"EquationEditor_dollarSign",children:"$"})]}):/* @__PURE__ */e("div",{className:"EquationEditor_inputBackground",children:[/* @__PURE__ */t("span",{className:"EquationEditor_dollarSign",children:"$$\n"}),/* @__PURE__ */t("textarea",{className:"EquationEditor_blockEditor",value:n,onChange:l,ref:i}),/* @__PURE__ */t("span",{className:"EquationEditor_dollarSign",children:"\n$$"})]})}const C=/* @__PURE__ */E(_);function v({equation:e,inline:o,nodeKey:E}){const[_]=a(),v=r(),[$,b]=p(e),[k,S]=p(!1),L=f(null),j=q(e=>{S(!1),_.update(()=>{const t=l(E);h(t)&&(t.setEquation($),e&&t.selectNext(0,0))})},[_,$,E]);return g(()=>{k||$===e||b(e)},[k,e,$]),g(()=>{if(v)return k?i(_.registerCommand(c,e=>{const t=document.activeElement;return L.current!==t&&j(),!1},s),_.registerCommand(u,e=>{const t=document.activeElement;return L.current===t&&(j(!0),!0)},s)):_.registerUpdateListener(({editorState:e})=>{e.read(()=>{const e=d();return m(e)&&e.has(E)&&1===e.getNodes().length})&&S(!0)})},[_,E,j,k,v]),/* @__PURE__ */t(n,{children:k&&v?/* @__PURE__ */t(C,{equation:$,setEquation:b,inline:o,ref:L}):/* @__PURE__ */t(x,{onError:e=>_._onError(e),fallback:null,children:/* @__PURE__ */t(N,{equation:$,inline:o,onDoubleClick:()=>{v&&S(!0)}})})})}export{v as default};
